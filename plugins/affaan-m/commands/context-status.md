# コンテキスト監視コマンド

## コマンド名
`/context-status`

## 説明
Claude Codeのコンテキスト使用状況を監視し、最適化の提案を行います。

## 使用方法

```bash
/context-status
```

## 実行内容

このコマンドは以下の情報を表示します：

### 1. コンテキスト使用率
- 現在のコンテキスト使用率（%）
- 使用可能なトークン数
- 消費済みトークン数

### 2. MCP設定状況
- アクティブなMCPサーバー数
- 有効化されているツール数
- 推奨設定との比較

### 3. 最適化推奨事項
- 60%を超える場合: `/compact`実行を推奨
- MCP数が10個を超える場合: 未使用MCPの無効化を推奨
- ツール数が80個を超える場合: MCP設定の見直しを推奨

## 出力例

```
📊 コンテキスト監視レポート
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

【コンテキスト使用率】
  使用率: 45% (90,000 / 200,000 トークン)
  ステータス: 正常 ✅

【MCP設定状況】
  アクティブMCPサーバー: 8個
  有効化ツール数: 65個
  ステータス: 推奨範囲内 ✅

【推奨事項】
  ✅ コンテキスト使用率は正常範囲です
  ✅ MCP設定は最適化されています
  ✅ 問題は検出されませんでした

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

## 警告レベル

### 注意（60%以上）
```
⚠️  コンテキスト使用率: 65%
推奨: `/compact`コマンドでコンテキストを圧縮してください
```

### 警告（80%以上）
```
🚨 コンテキスト使用率: 85%
緊急: 即座に`/compact`を実行してください
```

### MCP過剰
```
⚠️  アクティブMCPサーバー: 12個（推奨: 10個以下）
推奨: 未使用のMCPサーバーを無効化してください
```

### ツール数過剰
```
⚠️  有効化ツール数: 95個（推奨: 80個以下）
推奨: MCP設定を見直してください
```

## 自動監視機能

affaan-mプラグインでは、ツール実行時に自動的にコンテキスト使用率を監視します。

**自動アクション**:
- 60%超過時: 警告を表示
- 80%超過時: `/compact`の実行を強く推奨
- 設定ファイルで`autoCompact: true`の場合、自動的にコンパクト化を提案

## 関連コマンド

- `/compact` - コンテキストを圧縮
- `/status` - Claude Codeの全体ステータス確認

## 推奨使用タイミング

- 大規模なタスク開始前
- コンテキストが重く感じるとき
- MCP設定を変更した後
- 定期的なヘルスチェック（週1回程度）

## 注意事項

- このコマンドは読み取り専用で、設定を変更しません
- `/compact`は別途実行する必要があります
- MCP無効化は手動で行う必要があります

## トラブルシューティング

### コンテキスト使用率が常に高い場合

1. **未使用MCPを無効化**
   ```bash
   # グローバル設定を確認
   cat ~/.config/claude-code/mcp.json
   ```

2. **プロジェクト固有のMCPのみ有効化**
   ```bash
   # プロジェクト設定を確認
   cat .claude-code/mcp.json
   ```

3. **定期的にコンパクト化**
   ```bash
   /compact
   ```

### ツール数が多すぎる場合

1. **使用頻度の低いMCPサーバーを無効化**
2. **プロジェクトに必要なツールのみを有効化**
3. **グローバル設定を整理**

## ベストプラクティス

- **推奨MCP設定数**:
  - グローバル: 20-30個以内
  - プロジェクト: 10個以下
  - 総ツール数: 80個以下

- **監視頻度**:
  - タスク開始前に確認
  - 60%を超えたら定期的にチェック

- **最適化タイミング**:
  - プロジェクト開始時に必要なMCPを選定
  - 使用しないMCPは即座に無効化
  - 定期的に見直し（月1回程度）
