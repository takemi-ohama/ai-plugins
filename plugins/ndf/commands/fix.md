# PR修正コマンド

直前PR、または引数で指定されたPRのreview comment確認・修正対応実行。

## 実行
1. review comment確認
2. 修正可否判断
3. 問題点修正
4. コミット・プッシュ
5. PRにSummaryコメントを追加
6. 対応したコードコメントに個別に返信する
7. reviewerに再レビューを依頼
8. copilotに再レビューを依頼
9. 対応が完全に完了したコードコメントを「Resolve Conversation」にする

* 4. はgit, 1.と5.以降はgithub mcpまたはghを利用

**方針**:
* 品質・可読性・セキュリティ向上、既存機能影響なし
* 指摘がすべて正しいとは限らない。修正前に仕様を調査し、実施の可否を判断すること
    * 未対応の場合はその理由をコメントに書き込む

## 作業完了報告（必須）

作業完了時は以下の形式でPRにSummaryコメントを追加すること：

### 報告テンプレート（PRコメント用）

```markdown
## 🔧 PRレビュー指摘対応 (コミットハッシュ)

### 対応した指摘

| # | 優先度 | ファイル | 指摘内容 | 対応 |
|---|--------|---------|----------|------|
| 1 | **P1** | `file1.js` | [指摘内容の要約] | ✅ 修正済み |
| 2 | **P2** | `file2.js` | [指摘内容の要約] | ✅ 修正済み |
| 3 | **P2** | `file3.js` | [指摘内容の要約] | ❌ 未対応 (理由) |

---

### 修正1: [修正内容のタイトル]

**問題**: [何が問題だったか]

**修正**: [どう修正したか]

```javascript
// Before
[修正前のコード例]

// After
[修正後のコード例]
```

---

### 修正2: [修正内容のタイトル]

**問題**: [何が問題だったか]

**修正**: [どう修正したか]

---

### テスト結果

```
[テスト実行結果、または「手動確認済み」など]
```

### 修正ファイル

- `path/to/file1.js` - [修正内容の要約]
- `path/to/file2.js` - [修正内容の要約]
- `path/to/file3.md` - [修正内容の要約]
```

**PR URL**: [PR URL]

### 報告例

```markdown
## 🔧 PRレビュー指摘対応 (00661f1)

### 対応した指摘

| # | 優先度 | ファイル | 指摘内容 | 対応 |
|---|--------|---------|----------|------|
| 1 | **P1** | `secret-scan.js` | AWS_SECRET_ACCESS_KEYの正規表現が大文字小文字を区別 | ✅ 修正済み |
| 2 | **P1** | `secret-scan.js` | バイナリファイルの誤検知 | ✅ 修正済み |
| 3 | **P2** | `typescript-check.js` | TypeScript未インストール時のエラー | ✅ 修正済み |
| 4 | **P2** | `detect-package-manager.js` | 複数lockファイル競合時の警告 | ❌ 未対応 (検出順序に意味があるため) |

---

### 修正1: 正規表現の大文字小文字区別

**問題**: シークレットパターンが大文字小文字を区別していたため、小文字の環境変数を検出できなかった

**修正**: 全パターンに`i`フラグを追加

```javascript
// Before
pattern: /AWS_SECRET_ACCESS_KEY[\s]*=[\s]*["']?([A-Za-z0-9/+=]{40})["']?/

// After
pattern: /AWS_SECRET_ACCESS_KEY[\s]*=[\s]*["']?([A-Za-z0-9/+=]{40})["']?/i
```

---

### 修正2: バイナリファイルのフィルタリング

**問題**: 画像ファイルなどのバイナリファイルを検査対象に含めていた

**修正**: 拡張子でフィルタリングを追加

---

### 修正3: TypeScript事前確認

**問題**: TypeScriptがインストールされていない場合にエラーが発生

**修正**: `tsc --version`で事前確認し、未インストール時は警告を表示

---

### テスト結果

手動テストで各修正を確認済み。

### 修正ファイル

- `hooks/secret-scan.js` - 正規表現の改善とバイナリファイルフィルタリング
- `hooks/typescript-check.js` - TypeScript事前確認の追加
- `hooks/auto-format.js` - async修飾子の削除
- `hooks/console-log-detector.js` - async修飾子の削除
```
**PR URL**: https://github.com/takemi-ohama/ai-plugins/pull/13
