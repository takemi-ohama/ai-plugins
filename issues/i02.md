# Issue #02: @playwright/mcpパッケージのChromium認識問題

**報告日**: 2025-11-16
**ステータス**: 調査完了
**優先度**: 高

## 問題の概要

`npx -y @playwright/mcp@latest --browser chromium`で起動すると、以下のエラーが発生：

```
Browser specified in your config is not installed. Either install it (likely) or change the config.
```

`npx playwright install chromium`でChromiumをインストール済み（`~/.cache/ms-playwright/chromium-1194/`）にもかかわらず、ブラウザが認識されない。

## 根本原因

### 1. npx実行時の分離環境

`npx`経由で`@playwright/mcp`を実行すると、以下のような問題が発生：

- **一時的なnode_modules**: npxは一時的な場所に`@playwright/mcp`とその依存関係（`playwright@1.57.0-alpha-2025-11-14`、`playwright-core@1.57.0-alpha-2025-11-14`）をダウンロード
- **バージョン不一致**: 事前に`npx playwright install chromium`でインストールしたChromiumは、別バージョンのPlaywrightでインストールされた可能性がある
- **ブラウザパス認識の問題**: 各Playwrightインストールは、自身がインストールしたブラウザのみを認識する

### 2. Playwrightのブラウザ認識メカニズム

Playwrightは以下の順序でブラウザを検索：

1. **PLAYWRIGHT_BROWSERS_PATH環境変数**（最優先）
2. **デフォルトキャッシュディレクトリ**:
   - Linux: `~/.cache/ms-playwright`
   - macOS: `~/Library/Caches/ms-playwright`
   - Windows: `%USERPROFILE%\AppData\Local\ms-playwright`

しかし、**各Playwrightパッケージのバージョンは、それぞれ独自のブラウザバージョンを期待**する。

### 3. バージョン管理の問題

```bash
# 例: 以前インストールしたChromium
~/.cache/ms-playwright/chromium-1194/

# @playwright/mcpが期待するChromiumバージョン
# playwright@1.57.0-alpha-2025-11-14 が期待するバージョン
# → 異なる可能性がある
```
