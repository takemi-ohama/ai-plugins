# 開発AIエージェント向け指示書

* このドキュメントはClaude Codeなどの開発AIエージェント向けの指示書です。
* チャットで「docs/cmd01.mdのx番を実行してください」と言われたらこのファイルを読み、見出しに書いてある番号の内容を実行してください。
* 頻繁に書き換わるので、指示があるたびに読み込みなおしてください。
* 返答やドキュメントはすべて日本語で。


# 1. サブエージェント「director」追加
* ndf pluginに「director」サブエージェントを追加してください。
* directorは、main agentが担っていた責務すべてが担当です。
* main agentはできるだけ何もせず、サブエージェントへの指示のみに徹 するようにしてください。
* ファイル調査、プラン作成、結果の取りまとめなど。指示出し以外のすべての業務を可能な限りsub agentに任せるようにしてください。

# 2. 適切な状況報告体制の構築
* ndf:director sub agentはバックグラウンドで動作することを前提に、適切なタイミングごとに、mainエージェントに作業内容を報告するようにしてください。
    * また、main agentはsub agentの報告を受信してユーザに報告するようにしてください。
    * 報告は最初は1分毎、とし、タスクが長くなるようならそれに応じて報告間隔も広くしてください
    * plugins/ndf/CLAUDE.ndf.mdにもこの仕様を書いておいてください


# 3. slack-notify.js 処理順変更
plugins/ndf/scripts/slack-notify.js の処理を変更します。
* これまで、メンション付き通知→要約作衛→メンション削除→要約付きメッセージ通知、だったはずです。
* これを、要約作成→「メンション付きかつ要約付きメッセージ」送信→「メンションなし&要約付きメッセージ」送信→「メンション付きかつ要約付きメッセージ」削除、という順番としてください

# 4. サブエージェント、MCPのネスト禁止ルール追加
* サブエージェントを利用する際、サブエージェントがサブエージェントを呼ぶことを繰り返してしまう、coreダンプする現象が発生しているようです。
    * directorサブエージェントはたのサブエージェントやMCPを呼ぶことができる。ただしdirectors subagentやclaude code mcpを呼んではいけない(無限呼び出し回避)
    * director以外のサブエージェントは他のサブエージェントを呼んではいけない。
        * MCPは利用してかまわない。ただし無限呼び出しは防ぐこと
* 以上のルールに従って、plugins/ndf/agents/内のファイルやplugins/ndf/CLAUDE.ndf.mdを修正してください
