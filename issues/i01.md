# 開発AIエージェント向け指示書

* このドキュメントはClaude Codeなどの開発AIエージェント向けの指示書です。
* チャットで「docs/cmd01.mdのx番を実行してください」と言われたらこのファイルを読み、見出しに書いてある番号の内容を実行してください。
* 頻繁に書き換わるので、指示があるたびに読み込みなおしてください。
* 返答やドキュメントはすべて日本語で。


# 1. plugins/mcp-integration にcodex mcpを追加
https://zenn.dev/tmasuyama1114/articles/cdfd4562bdce78
* この記事を参考にplugins/mcp-integrationでinstallするMCPにcodex cli mcpを追加してください
* README.mdなども修正してください


# 2. context7追加
plugins/ndf にcontext7 mcpを追加します
https://github.com/upstash/context7

# 3. サブエージェント追加
plugins/ndf にサブエージェントも追加します。
  * data analyst ... bigquery, dbhubの操作を担当。SQL生成と結果の解釈、結果データのファイル出力を担当する。
  * corder ... コーディングを担当。codex mcp, serena mcp, context7 mcpを活用し品質の高いコードを生成する。
  * researcher ... 調査担当。codex mcpやaws documentation mcp, Chrome DevToolsを活用し、外部サイトから情報を収集。分析して結果を返す
  * scanner ... 画像、PDF、Officeファイル担当。pdf、画像、ppt、xlsといったClaude Codeが直接読めないファイルをcodex mcpに任せて読み取ってもらう。

# 4. README.md拡充
* plugins/ndf/README.md に必要事項を追加します。
    * plugins/mcp-integration/README.mdを参考に、DATABASE_DSNなどの設定方法を追加
    * plugins/install-slack-hook/README.md を参考にSLACK BOTの設定方法

# 5. mainエージェントへの指示
plugins/ndf/
* mainエージェント(親エージェント)にsub agentの役割と積極活用を促す指示を追加してください
# 6. slack通知に作業要約追加
plugins/ndf/hooks/hooks.json
* slack-notify.shをstop hookで呼び出しています。
* この処理を以下のように変更してください。
* promptで40文字以内の日本語要約を作成
* agent toolで要約を引数につけてslack-notify.shを呼び出す

# 7. クリーニング
* plugins/ndf/agents/slack-notifier.md 不要になったので削除してください
* ndfのバージョンを1.0.2としてください
* plugins/ndf/scripts/slack-notify.sh こちらもおそらく不要です。念のため確認してから削除
* ndfのREADME.md, CLAUDE.mdを修正
* プロジェクトルートのREADME.md, CLAUDE.mdも修正

# 8. リファクタリング
* plugins/ndf/scripts/slack-notify.js をリファクタリングしてください
  * 目的は可読性の向上と冗長なコードの簡潔化です。

# 9. クリーニング2
* plugins/ndf/agents/memory-recorder.md こちらも利用しないことになったので削除してください
* ndfのREADME.md, CLAUDE.mdを修正
* プロジェクトルートのREADME.md, CLAUDE.mdも修正

# 10. 品質管理サブエージェントの追加
* plugins/ndf/agents 品質管理(qa)を担当するサブエージェントを追加してください。

# 11. CLAUDE.md方針
* plugins/ndf/CLAUDE.md を以下の方針としてください
* 大方針
  * 日本語で応答
  * 勝手なgit pushは禁止。特にデフォルトブランチにはpushしない。
* 行動指針
  * コンテキストの管理、段階的開示を意識する
  * sub agent, mcpの積極活用
  * mainエージェントはtodolistの管理と結果の統合に徹し、それ以外はできるだけサブエージェントに任せる
  * serena mcpはmain, subいずれのエージェントでも活用する
    * serena mcpの使い方をCLAUDE.mdに記載しておく
    * 特にテキストファイルの読み書きは原則serena mcpを利用して行う
    * PDF、画像、officeツール(xls, pptなど)などのバイナリファイルの読み取りはscannerエージェント経由でcodex mcpに依頼
  * 事実を調査する
    * 技術的に難易度が高い課題はresearcherによって外部リソースを調査してから解決策を検討する
  * 現在記載されているStop Hookに関する事項は解消されたので不要になりました。

# 12. README.md改善
* plugins/ndf/README.md を改修します
* README.mdはユーザ向け、CLAUDE.mdはエージェント向けです。
  * 設定では、先に設定ステップ全体の流れを説明してから、設定方法の詳細に入ってください
  * 開発ワークフローの説明をmcpよりも先にしてください。
  * mcpの詳細説明はCLAUDE.mdを参照するように記載し、ここでの説明は最小限にしてください
* DBHubについて
  * DBHubの設定の説明が冗長です。例はなくて良いでしょう。
  * DBHubの設定の説明で、mysqlとmariadbは設定方法が同じなのでまとめてください
  * SSLの説明はPostgresのセクションに記述してください
  * SSHによる踏み台経由の接続方法についても記載して下さい(mysqlのみでも可)
* 開発ワークフローコマンドの使用例は不要です(大体コマンド名が記載されているだけなので)。
  * 何をするコマンドなのか、いつ使うのかを2-3行程度で説明してください
* mcpの説明で、使わないmcpはdisableしておくことを推奨し、diableの手順を記載してください
* 自動フックの説明は古いです。現状に合わせてください
* トラブルシューティングはこの内容なら不要です。

* ついでにplugins/ndf/CLAUDE.md も修正
  * 勝手にpushしない、をpush/mergeしないに修正
    * PRのmergeはユーザが行う前提です。
  * タスク分類のフローチャート はmermaid記法で記載してください
